# 管理员功能使用指南

> **版本**: v1.1 (2025-11-02)
> **状态**: ✅ 完整实现并已上线

---

## 📋 快速开始

### 登录管理员账户

使用管理员账户登录系统：

```
用户名: rachel
密码: Test123
角色: admin
```

登录后，点击右上角菜单按钮（≡），选择"User Management"（👥）进入用户管理界面。

---

## 🎯 功能概览

管理员可以执行以下操作：

| 功能 | 说明 |
|------|------|
| **查看用户列表** | 浏览所有用户，支持分页显示 |
| **搜索用户** | 按用户名或邮箱搜索 |
| **筛选用户** | 按角色筛选（User/Admin） |
| **创建用户** | 添加新的普通用户或管理员 |
| **编辑用户** | 修改用户名、邮箱、角色 |
| **重置密码** | 为任何用户重置密码 |
| **删除用户** | 删除单个或批量删除用户 |

---

## 🖥️ 用户管理界面

### 表格列说明

| 列名 | 说明 | 示例 |
|------|------|------|
| **☑️** | 多选框，用于批量操作 | - |
| **ID** | 用户唯一标识符（UUID） | `550e8400-e29b...` |
| **Username** | 用户名 | `rachel` |
| **Email** | 用户邮箱 | `user@example.com` |
| **Role** | 角色徽章 | `admin` / `user` |
| **Created At** | 账户创建日期 | `2025/11/2` |
| **Actions** | 操作按钮 | ✏️ 🔑 🗑️ |

### 操作按钮

- **✏️ 编辑**: 修改用户信息
- **🔑 重置密码**: 为用户设置新密码
- **🗑️ 删除**: 删除用户账户（需确认）

---

## 📖 详细操作指南

### 1. 查看用户列表

**访问路径**: Dashboard → 菜单（≡）→ User Management

**功能**:
- 默认显示所有用户，每页20条
- 分页显示格式：`Page 1 of 1 (Total: 9 users)`
- 即使只有一页也会显示总用户数

---

### 2. 搜索用户

**操作步骤**:
1. 在搜索框输入关键词（用户名或邮箱）
2. 搜索结果实时更新
3. 清空搜索框可返回完整列表

**示例**:
- 搜索 `rachel` → 显示所有包含"rachel"的用户名或邮箱
- 支持模糊匹配

---

### 3. 筛选用户

**角色筛选器**:
- **All Roles**: 显示所有用户
- **User**: 只显示普通用户
- **Admin**: 只显示管理员

---

### 4. 创建新用户

**操作步骤**:
1. 点击"+ Create User"按钮
2. 填写表单：
   - **Username** *（必填）: 3-32字符，只能包含字母、数字、下划线
   - **Email** *（必填）: 有效的邮箱地址
   - **Password** *（必填）: 至少8字符，必须包含大写、小写字母和数字
   - **Role**: 选择 `user` 或 `admin`
3. 点击"Create"按钮

**密码要求**:
```
✓ 最少8个字符
✓ 包含小写字母 [a-z]
✓ 包含大写字母 [A-Z]
✓ 包含数字 [0-9]

示例: Test1234, Admin123, Password1
```

---

### 5. 编辑用户信息

**操作步骤**:
1. 点击用户行的 ✏️ 按钮
2. 在弹出窗口中修改：
   - 用户名
   - 邮箱
   - 角色（user ↔ admin）
3. 点击"Update"保存

**限制**:
- ⚠️ 不能将最后一个管理员降级为普通用户
- ⚠️ 修改的用户名和邮箱必须唯一

---

### 6. 重置用户密码

**操作步骤**:
1. 点击用户行的 🔑 按钮
2. 输入新密码（需符合密码强度要求）
3. 点击"Reset Password"

**安全提示**:
- 新密码立即生效
- 用户需要使用新密码登录

---

### 7. 删除用户

#### 单个删除

**操作步骤**:
1. 点击用户行的 🗑️ 按钮
2. 在确认对话框中点击"确认删除"
3. 用户及其所有数据（会话、对话）将被删除

#### 批量删除

**操作步骤**:
1. 勾选要删除的用户（点击左侧复选框）
2. 点击"Delete Selected (X)"按钮
3. 确认删除

**保护机制**:
- ❌ 不能删除自己
- ❌ 不能删除最后一个管理员
- ⚠️ 删除操作不可撤销！

---

## 🔧 API 使用（开发者）

### 认证方式

所有管理员API都需要JWT认证：

```bash
# 1. 登录获取token
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"rachel","password":"Test123"}' \
  -c cookies.txt

# 2. 使用cookie访问管理员API
curl -X GET "http://localhost:8000/api/v1/admin/users" \
  -b cookies.txt
```

### API端点列表

| 方法 | 端点 | 说明 |
|------|------|------|
| GET | `/api/v1/admin/users` | 获取用户列表 |
| GET | `/api/v1/admin/users/{id}` | 获取用户详情 |
| POST | `/api/v1/admin/users` | 创建新用户 |
| PUT | `/api/v1/admin/users/{id}` | 更新用户信息 |
| POST | `/api/v1/admin/users/{id}/reset-password` | 重置密码 |
| DELETE | `/api/v1/admin/users/{id}` | 删除用户 |
| POST | `/api/v1/admin/users/batch-delete` | 批量删除 |

详细API文档请参考：[管理员用户管理功能实现方案.md](./管理员用户管理功能实现方案.md)

---

## ❓ 常见问题

### Q1: 忘记管理员密码怎么办？

**解决方案**: 使用后端脚本重置：

```bash
cd backend
source venv/bin/activate
python3 reset_rachel_password.py
```

### Q2: 创建用户时提示"用户名已存在"？

**原因**: 用户名必须唯一
**解决**: 使用其他用户名

### Q3: 为什么不能删除某个用户？

**可能原因**:
1. 尝试删除自己（系统禁止）
2. 尝试删除最后一个管理员（系统禁止）

### Q4: 如何添加更多管理员？

**步骤**:
1. 创建新用户，Role选择"Admin"
2. 或编辑现有用户，将Role改为"Admin"

---

## 🔒 安全提示

1. **保护管理员账户**: 使用强密码并定期更换
2. **谨慎授予管理员权限**: 只给可信用户admin角色
3. **删除前仔细确认**: 删除操作不可恢复
4. **定期审查用户列表**: 移除不再需要的账户

---

## 📞 技术支持

如遇问题，请检查：

1. **浏览器控制台**: 查看错误日志
2. **网络请求**: 检查API返回的错误信息
3. **后端日志**: 查看服务器端错误

**问题反馈**: 请在GitHub Issues中提交

---

**文档版本**: v1.1
**最后更新**: 2025-11-02
**维护者**: SystemX Team
